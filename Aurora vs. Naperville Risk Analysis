{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 47,
   "id": "94c86715-de04-482d-a065-7823d5225f89",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.12/site-packages (2.2.2)\n",
      "Requirement already satisfied: numpy>=1.26.0 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (1.26.4)\n",
      "Requirement already satisfied: python-dateutil>=2.8.2 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (2.9.0.post0)\n",
      "Requirement already satisfied: pytz>=2020.1 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (2024.1)\n",
      "Requirement already satisfied: tzdata>=2022.7 in /opt/anaconda3/lib/python3.12/site-packages (from pandas) (2023.3)\n",
      "Requirement already satisfied: six>=1.5 in /opt/anaconda3/lib/python3.12/site-packages (from python-dateutil>=2.8.2->pandas) (1.16.0)\n"
     ]
    }
   ],
   "source": [
    "!pip install pandas"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 98,
   "id": "87c793a8-2386-4bce-8a5f-0f9b85f1eae4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>State</th>\n",
       "      <th>County</th>\n",
       "      <th>FIPS Code</th>\n",
       "      <th>Geographic Coordinates</th>\n",
       "      <th>Life Expectancy</th>\n",
       "      <th>Current Adult Asthma</th>\n",
       "      <th>Stroke</th>\n",
       "      <th>COPD</th>\n",
       "      <th>CHD</th>\n",
       "      <th>High Blood Pressure</th>\n",
       "      <th>...</th>\n",
       "      <th>Frost Days</th>\n",
       "      <th>Maximum of maximum temperatures</th>\n",
       "      <th>Mean temperature</th>\n",
       "      <th>Urban Heat Island Extreme Heat Days</th>\n",
       "      <th>Drought - Annualized Frequency</th>\n",
       "      <th>Consecutive Dry Days</th>\n",
       "      <th>Wildfire - Annualized Frequency</th>\n",
       "      <th>Surface PM2.5</th>\n",
       "      <th>Snowfall</th>\n",
       "      <th>Standardized Precip Index</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043840000</td>\n",
       "      <td>+41.9784876,-087.9395607</td>\n",
       "      <td>78.6</td>\n",
       "      <td>9.2</td>\n",
       "      <td>2.9</td>\n",
       "      <td>6.7</td>\n",
       "      <td>5.6</td>\n",
       "      <td>29.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.814463</td>\n",
       "      <td>3.748887</td>\n",
       "      <td>3.566866</td>\n",
       "      <td>13.666667</td>\n",
       "      <td>9.722222</td>\n",
       "      <td>-0.090058</td>\n",
       "      <td>2.010000e-06</td>\n",
       "      <td>-2.576237</td>\n",
       "      <td>-0.128721</td>\n",
       "      <td>36.375177</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043840101</td>\n",
       "      <td>+41.9765040,-087.9764972</td>\n",
       "      <td>77.5</td>\n",
       "      <td>9.3</td>\n",
       "      <td>3.1</td>\n",
       "      <td>7.4</td>\n",
       "      <td>6.1</td>\n",
       "      <td>31.7</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.814463</td>\n",
       "      <td>3.748887</td>\n",
       "      <td>3.566866</td>\n",
       "      <td>13.666667</td>\n",
       "      <td>9.722222</td>\n",
       "      <td>-0.090058</td>\n",
       "      <td>1.010000e-06</td>\n",
       "      <td>-2.576237</td>\n",
       "      <td>-0.128721</td>\n",
       "      <td>36.375177</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043840102</td>\n",
       "      <td>+41.9597139,-087.9944205</td>\n",
       "      <td>83.6</td>\n",
       "      <td>9.0</td>\n",
       "      <td>2.9</td>\n",
       "      <td>6.8</td>\n",
       "      <td>5.9</td>\n",
       "      <td>32.2</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.826956</td>\n",
       "      <td>3.765808</td>\n",
       "      <td>3.575408</td>\n",
       "      <td>13.666667</td>\n",
       "      <td>9.722222</td>\n",
       "      <td>-0.111583</td>\n",
       "      <td>7.410000e-06</td>\n",
       "      <td>-2.562325</td>\n",
       "      <td>-0.127106</td>\n",
       "      <td>35.950142</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043840103</td>\n",
       "      <td>+41.9468911,-087.9738872</td>\n",
       "      <td>80.7</td>\n",
       "      <td>8.9</td>\n",
       "      <td>3.2</td>\n",
       "      <td>7.3</td>\n",
       "      <td>6.8</td>\n",
       "      <td>34.8</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.814463</td>\n",
       "      <td>3.748887</td>\n",
       "      <td>3.566866</td>\n",
       "      <td>13.666667</td>\n",
       "      <td>9.722222</td>\n",
       "      <td>-0.090058</td>\n",
       "      <td>6.180000e-06</td>\n",
       "      <td>-2.576237</td>\n",
       "      <td>-0.128721</td>\n",
       "      <td>36.375177</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043840104</td>\n",
       "      <td>+41.9426312,-087.9918507</td>\n",
       "      <td>81.4</td>\n",
       "      <td>9.4</td>\n",
       "      <td>3.3</td>\n",
       "      <td>7.7</td>\n",
       "      <td>6.6</td>\n",
       "      <td>32.1</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.823227</td>\n",
       "      <td>3.760758</td>\n",
       "      <td>3.572858</td>\n",
       "      <td>13.666667</td>\n",
       "      <td>9.722222</td>\n",
       "      <td>-0.105158</td>\n",
       "      <td>8.390000e-06</td>\n",
       "      <td>-2.566477</td>\n",
       "      <td>-0.127588</td>\n",
       "      <td>36.077006</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>293</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089854504</td>\n",
       "      <td>+41.7924935,-088.4411560</td>\n",
       "      <td>82.0</td>\n",
       "      <td>8.5</td>\n",
       "      <td>2.4</td>\n",
       "      <td>5.6</td>\n",
       "      <td>5.1</td>\n",
       "      <td>29.2</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.885447</td>\n",
       "      <td>3.845032</td>\n",
       "      <td>3.615398</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>10.888889</td>\n",
       "      <td>-0.212364</td>\n",
       "      <td>8.010000e-06</td>\n",
       "      <td>-2.497188</td>\n",
       "      <td>-0.119543</td>\n",
       "      <td>33.960176</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>294</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089854600</td>\n",
       "      <td>+42.0432175,-088.2866029</td>\n",
       "      <td>80.4</td>\n",
       "      <td>9.5</td>\n",
       "      <td>2.5</td>\n",
       "      <td>5.7</td>\n",
       "      <td>4.4</td>\n",
       "      <td>26.1</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.802498</td>\n",
       "      <td>3.888991</td>\n",
       "      <td>3.683808</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>10.500000</td>\n",
       "      <td>-0.511574</td>\n",
       "      <td>8.120000e-07</td>\n",
       "      <td>-2.281400</td>\n",
       "      <td>-0.127099</td>\n",
       "      <td>34.893641</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>295</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089854700</td>\n",
       "      <td>+41.7537141,-088.3259868</td>\n",
       "      <td>75.5</td>\n",
       "      <td>9.7</td>\n",
       "      <td>3.2</td>\n",
       "      <td>7.2</td>\n",
       "      <td>6.0</td>\n",
       "      <td>30.6</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.885447</td>\n",
       "      <td>3.845032</td>\n",
       "      <td>3.615398</td>\n",
       "      <td>16.000000</td>\n",
       "      <td>10.111111</td>\n",
       "      <td>-0.212364</td>\n",
       "      <td>2.490000e-07</td>\n",
       "      <td>-2.497188</td>\n",
       "      <td>-0.119543</td>\n",
       "      <td>33.960176</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>296</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089854800</td>\n",
       "      <td>+41.8751797,-088.3581993</td>\n",
       "      <td>84.0</td>\n",
       "      <td>8.4</td>\n",
       "      <td>2.1</td>\n",
       "      <td>4.8</td>\n",
       "      <td>4.3</td>\n",
       "      <td>26.0</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.885447</td>\n",
       "      <td>3.845032</td>\n",
       "      <td>3.615398</td>\n",
       "      <td>15.333333</td>\n",
       "      <td>10.888889</td>\n",
       "      <td>-0.212364</td>\n",
       "      <td>7.710000e-06</td>\n",
       "      <td>-2.497188</td>\n",
       "      <td>-0.119543</td>\n",
       "      <td>33.960176</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>297</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089854900</td>\n",
       "      <td>+42.0146449,-088.2964790</td>\n",
       "      <td>79.0</td>\n",
       "      <td>9.6</td>\n",
       "      <td>2.9</td>\n",
       "      <td>6.6</td>\n",
       "      <td>5.3</td>\n",
       "      <td>29.2</td>\n",
       "      <td>...</td>\n",
       "      <td>-31.806958</td>\n",
       "      <td>3.886627</td>\n",
       "      <td>3.680129</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>10.888889</td>\n",
       "      <td>-0.495484</td>\n",
       "      <td>2.050000e-06</td>\n",
       "      <td>-2.293004</td>\n",
       "      <td>-0.126693</td>\n",
       "      <td>34.843443</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>298 rows × 82 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    State  County    FIPS Code    Geographic Coordinates  Life Expectancy  \\\n",
       "0      IL  DuPage  17043840000  +41.9784876,-087.9395607             78.6   \n",
       "1      IL  DuPage  17043840101  +41.9765040,-087.9764972             77.5   \n",
       "2      IL  DuPage  17043840102  +41.9597139,-087.9944205             83.6   \n",
       "3      IL  DuPage  17043840103  +41.9468911,-087.9738872             80.7   \n",
       "4      IL  DuPage  17043840104  +41.9426312,-087.9918507             81.4   \n",
       "..    ...     ...          ...                       ...              ...   \n",
       "293    IL    Kane  17089854504  +41.7924935,-088.4411560             82.0   \n",
       "294    IL    Kane  17089854600  +42.0432175,-088.2866029             80.4   \n",
       "295    IL    Kane  17089854700  +41.7537141,-088.3259868             75.5   \n",
       "296    IL    Kane  17089854800  +41.8751797,-088.3581993             84.0   \n",
       "297    IL    Kane  17089854900  +42.0146449,-088.2964790             79.0   \n",
       "\n",
       "     Current Adult Asthma  Stroke  COPD  CHD  High Blood Pressure   ...  \\\n",
       "0                     9.2     2.9   6.7  5.6                  29.0  ...   \n",
       "1                     9.3     3.1   7.4  6.1                  31.7  ...   \n",
       "2                     9.0     2.9   6.8  5.9                  32.2  ...   \n",
       "3                     8.9     3.2   7.3  6.8                  34.8  ...   \n",
       "4                     9.4     3.3   7.7  6.6                  32.1  ...   \n",
       "..                    ...     ...   ...  ...                   ...  ...   \n",
       "293                   8.5     2.4   5.6  5.1                  29.2  ...   \n",
       "294                   9.5     2.5   5.7  4.4                  26.1  ...   \n",
       "295                   9.7     3.2   7.2  6.0                  30.6  ...   \n",
       "296                   8.4     2.1   4.8  4.3                  26.0  ...   \n",
       "297                   9.6     2.9   6.6  5.3                  29.2  ...   \n",
       "\n",
       "     Frost Days  Maximum of maximum temperatures  Mean temperature  \\\n",
       "0    -31.814463                         3.748887          3.566866   \n",
       "1    -31.814463                         3.748887          3.566866   \n",
       "2    -31.826956                         3.765808          3.575408   \n",
       "3    -31.814463                         3.748887          3.566866   \n",
       "4    -31.823227                         3.760758          3.572858   \n",
       "..          ...                              ...               ...   \n",
       "293  -31.885447                         3.845032          3.615398   \n",
       "294  -31.802498                         3.888991          3.683808   \n",
       "295  -31.885447                         3.845032          3.615398   \n",
       "296  -31.885447                         3.845032          3.615398   \n",
       "297  -31.806958                         3.886627          3.680129   \n",
       "\n",
       "     Urban Heat Island Extreme Heat Days  Drought - Annualized Frequency  \\\n",
       "0                              13.666667                        9.722222   \n",
       "1                              13.666667                        9.722222   \n",
       "2                              13.666667                        9.722222   \n",
       "3                              13.666667                        9.722222   \n",
       "4                              13.666667                        9.722222   \n",
       "..                                   ...                             ...   \n",
       "293                            15.000000                       10.888889   \n",
       "294                            14.000000                       10.500000   \n",
       "295                            16.000000                       10.111111   \n",
       "296                            15.333333                       10.888889   \n",
       "297                            14.000000                       10.888889   \n",
       "\n",
       "     Consecutive Dry Days  Wildfire - Annualized Frequency  Surface PM2.5  \\\n",
       "0               -0.090058                     2.010000e-06      -2.576237   \n",
       "1               -0.090058                     1.010000e-06      -2.576237   \n",
       "2               -0.111583                     7.410000e-06      -2.562325   \n",
       "3               -0.090058                     6.180000e-06      -2.576237   \n",
       "4               -0.105158                     8.390000e-06      -2.566477   \n",
       "..                    ...                              ...            ...   \n",
       "293             -0.212364                     8.010000e-06      -2.497188   \n",
       "294             -0.511574                     8.120000e-07      -2.281400   \n",
       "295             -0.212364                     2.490000e-07      -2.497188   \n",
       "296             -0.212364                     7.710000e-06      -2.497188   \n",
       "297             -0.495484                     2.050000e-06      -2.293004   \n",
       "\n",
       "     Snowfall  Standardized Precip Index  \n",
       "0   -0.128721                  36.375177  \n",
       "1   -0.128721                  36.375177  \n",
       "2   -0.127106                  35.950142  \n",
       "3   -0.128721                  36.375177  \n",
       "4   -0.127588                  36.077006  \n",
       "..        ...                        ...  \n",
       "293 -0.119543                  33.960176  \n",
       "294 -0.127099                  34.893641  \n",
       "295 -0.119543                  33.960176  \n",
       "296 -0.119543                  33.960176  \n",
       "297 -0.126693                  34.843443  \n",
       "\n",
       "[298 rows x 82 columns]"
      ]
     },
     "execution_count": 98,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_csv(\"Air Quality Native Units.csv\")\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 104,
   "id": "29e89bc6-5606-4fe2-9a15-2646660f6dd9",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Saved results to v2_top20_sensor_candidates.csv\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from sklearn.ensemble import RandomForestRegressor\n",
    "from sklearn.preprocessing import StandardScaler\n",
    "\n",
    "# Load data from CSV file\n",
    "df = pd.read_csv(\"Air Quality Native Units.csv\")\n",
    "coords = df['Geographic Coordinates'].astype(str).str.replace('[()]', '', regex=True)\n",
    "lat_lon = coords.str.split(',', expand=True)\n",
    "df['latitude'] = lat_lon[0].astype(float)\n",
    "df['longitude'] = lat_lon[1].astype(float)\n",
    "\n",
    "# Filter rows within Aurora or Naperville\n",
    "aurora_bounds = {'lat_min': 41.72, 'lat_max': 42.00, 'lon_min': -88.44, 'lon_max': -88.18}\n",
    "naperville_bounds = {'lat_min': 41.65, 'lat_max': 41.80, 'lon_min': -88.25, 'lon_max': -88.14}\n",
    "is_in_aurora = (\n",
    "    (df['latitude'] >= aurora_bounds['lat_min']) & (df['latitude'] <= aurora_bounds['lat_max']) &\n",
    "    (df['longitude'] >= aurora_bounds['lon_min']) & (df['longitude'] <= aurora_bounds['lon_max'])\n",
    ")\n",
    "is_in_naperville = (\n",
    "    (df['latitude'] >= naperville_bounds['lat_min']) & (df['latitude'] <= naperville_bounds['lat_max']) &\n",
    "    (df['longitude'] >= naperville_bounds['lon_min']) & (df['longitude'] <= naperville_bounds['lon_max'])\n",
    ")\n",
    "# NEW: Label each row with City based on the bounding-box masks\n",
    "both = is_in_aurora & is_in_naperville\n",
    "df['City'] = np.select(\n",
    "    [both, is_in_aurora, is_in_naperville],\n",
    "    ['Both', 'Aurora', 'Naperville'],\n",
    "    default='Other'\n",
    ")\n",
    "\n",
    "filtered_df = df[is_in_aurora | is_in_naperville].reset_index(drop=True)  #new list for rows consisting of Aurora/Napervile and restart index\n",
    "\n",
    "# Identify all columns\n",
    "identifier_columns = ['State', 'County', 'FIPS Code', 'Geographic Coordinates']\n",
    "all_number_columns = filtered_df.select_dtypes(include='number').columns.tolist()\n",
    "metric_columns = [col for col in all_number_columns if col not in identifier_columns + ['latitude', 'longitude']] #only quantitative var. list\n",
    "\n",
    "# Top 10 census tracts with the highest values for each metric\n",
    "top10_records = []\n",
    "for metric in metric_columns:\n",
    "    top10_rows = filtered_df.nlargest(10, metric)  #gets top 10 from each column's top 10 rows, \n",
    "    #if we're at metric = PM2.5, it gets its top 10 numbers from data\n",
    "    for _, row in top10_rows.iterrows(): #goes through the 10 rows\n",
    "        record = {col: row[col] for col in identifier_columns} #creates a small dictionary containing the State, County, etc. identitfies\n",
    "        record['Metric'] = metric #adds the metric for which the top 10 was for\n",
    "        top10_records.append(record) #creates a growing list, storing that dictionary (new list called top10_records)\n",
    "\n",
    "top10_df = pd.DataFrame(top10_records) #makes things easier to read, showing the variables & their values\n",
    "\n",
    "# Count how many times each location appeared in the top 10 lists\n",
    "top10_df['LocationKey'] = top10_df[identifier_columns].astype(str).agg(', '.join, axis=1) #new column per row\n",
    "location_counts = top10_df['LocationKey'].value_counts().reset_index()\n",
    "location_counts.columns = ['LocationKey', 'Count'] #create a table of “repeat offenders” where a higher Count means the tract was top-10 for more metrics.\n",
    "\n",
    "# Prepare the data to train a model\n",
    "X_list = []\n",
    "y_list = []\n",
    "for _, row in location_counts.iterrows():\n",
    "    fips = int(row['LocationKey'].split(', ')[2])\n",
    "    tract = filtered_df[filtered_df['FIPS Code'] == fips]\n",
    "    features = tract[metric_columns].fillna(0).iloc[0].values\n",
    "    X_list.append(features)\n",
    "    y_list.append(row['Count'])\n",
    "\n",
    "X = np.array(X_list)\n",
    "y = np.array(y_list)\n",
    "\n",
    "scaler = StandardScaler().fit(X)\n",
    "X_scaled = scaler.transform(X)\n",
    "\n",
    "# Train model and score all tracts\n",
    "model = RandomForestRegressor(n_estimators=200, random_state=0)\n",
    "model.fit(X_scaled, y)\n",
    "\n",
    "all_features = filtered_df[metric_columns].fillna(0).values\n",
    "all_scaled = scaler.transform(all_features)\n",
    "filtered_df['RiskScore'] = model.predict(all_scaled)\n",
    "top20_aurora = filtered_df[filtered_df[\"City\"] == \"Aurora\"].nlargest(20, \"RiskScore\").reset_index(drop=True)\n",
    "top20_naperville = filtered_df[filtered_df[\"City\"] == \"Naperville\"].nlargest(20, \"RiskScore\").reset_index(drop=True)\n",
    "top20_both = filtered_df[filtered_df[\"City\"] == \"Both\"].nlargest(20, \"RiskScore\").reset_index(drop=True)\n",
    "top20_df = filtered_df.nlargest(20, 'RiskScore').reset_index(drop=True)\n",
    "\n",
    "# Explanations for why each tract was selected\n",
    "reasons = []\n",
    "for _, row in top20_df.iterrows():\n",
    "    loc_key = f\"{row['State']}, {row['County']}, {row['FIPS Code']}, {row['Geographic Coordinates']}\"\n",
    "    loc_metrics = top10_df[top10_df['LocationKey'] == loc_key]['Metric']\n",
    "    count = len(loc_metrics)\n",
    "    top3 = loc_metrics.value_counts().head(3).index.tolist()\n",
    "    reason = (f\"Appears in {count} top-10 lists; \"\n",
    "              f\"ain factors: {top3[0]}, {top3[1]}, {top3[2]}\")\n",
    "    reasons.append(reason)\n",
    "\n",
    "top20_df['Reason'] = reasons\n",
    "\n",
    "# CSV file\n",
    "output_file = 'v2_top20_sensor_candidates.csv'\n",
    "top20_df[identifier_columns + ['City', 'RiskScore', 'Reason']].to_csv(output_file, index=False)\n",
    "print(f\"Saved results to {output_file}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 106,
   "id": "b3242731-cac7-4be8-9854-9ad83c3221f6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>State</th>\n",
       "      <th>County</th>\n",
       "      <th>FIPS Code</th>\n",
       "      <th>Geographic Coordinates</th>\n",
       "      <th>City</th>\n",
       "      <th>RiskScore</th>\n",
       "      <th>Reason</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841308</td>\n",
       "      <td>+41.9708120,-088.2296714</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>35.080</td>\n",
       "      <td>Appears in 38 top-10 lists; ain factors: Life ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841313</td>\n",
       "      <td>+41.9248149,-088.2282145</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>34.950</td>\n",
       "      <td>Appears in 38 top-10 lists; ain factors: Strok...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841326</td>\n",
       "      <td>+41.9175991,-088.1853745</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>32.225</td>\n",
       "      <td>Appears in 34 top-10 lists; ain factors: Delay...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841316</td>\n",
       "      <td>+41.9766800,-088.1947833</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>30.230</td>\n",
       "      <td>Appears in 31 top-10 lists; ain factors: Delay...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841310</td>\n",
       "      <td>+41.9427967,-088.2393281</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>29.660</td>\n",
       "      <td>Appears in 30 top-10 lists; ain factors: Delay...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841312</td>\n",
       "      <td>+41.9117874,-088.2357549</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>29.450</td>\n",
       "      <td>Appears in 32 top-10 lists; ain factors: Life ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841327</td>\n",
       "      <td>+41.9524395,-088.1967182</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>27.845</td>\n",
       "      <td>Appears in 28 top-10 lists; ain factors: Delay...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841504</td>\n",
       "      <td>+41.8834958,-088.2007375</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>25.650</td>\n",
       "      <td>Appears in 23 top-10 lists; ain factors: Delay...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841501</td>\n",
       "      <td>+41.8885022,-088.2248959</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>24.960</td>\n",
       "      <td>Appears in 31 top-10 lists; ain factors: COPD,...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089851801</td>\n",
       "      <td>+41.9965296,-088.2842287</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>22.130</td>\n",
       "      <td>Appears in 28 top-10 lists; ain factors: Flood...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089851907</td>\n",
       "      <td>+41.9958776,-088.3274083</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>21.745</td>\n",
       "      <td>Appears in 19 top-10 lists; ain factors: Flood...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841503</td>\n",
       "      <td>+41.8701285,-088.1994782</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>18.235</td>\n",
       "      <td>Appears in 22 top-10 lists; ain factors: Delay...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089852001</td>\n",
       "      <td>+41.9627177,-088.2836407</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>16.180</td>\n",
       "      <td>Appears in 18 top-10 lists; ain factors: Modif...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>IL</td>\n",
       "      <td>DuPage</td>\n",
       "      <td>17043841605</td>\n",
       "      <td>+41.8598398,-088.2287261</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>14.110</td>\n",
       "      <td>Appears in 12 top-10 lists; ain factors: Flood...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089852102</td>\n",
       "      <td>+41.9575234,-088.3276754</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>12.780</td>\n",
       "      <td>Appears in 14 top-10 lists; ain factors: Life ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089853004</td>\n",
       "      <td>+41.8000611,-088.3357209</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>11.535</td>\n",
       "      <td>Appears in 15 top-10 lists; ain factors: Strok...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089852003</td>\n",
       "      <td>+41.9304462,-088.2853791</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>11.075</td>\n",
       "      <td>Appears in 11 top-10 lists; ain factors: CHD, ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089852300</td>\n",
       "      <td>+41.9115668,-088.3103948</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>10.645</td>\n",
       "      <td>Appears in 12 top-10 lists; ain factors: Flood...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089852002</td>\n",
       "      <td>+41.9092371,-088.2859844</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>10.480</td>\n",
       "      <td>Appears in 10 top-10 lists; ain factors: Flood...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>IL</td>\n",
       "      <td>Kane</td>\n",
       "      <td>17089852101</td>\n",
       "      <td>+41.9494354,-088.3541544</td>\n",
       "      <td>Aurora</td>\n",
       "      <td>9.865</td>\n",
       "      <td>Appears in 10 top-10 lists; ain factors: Food ...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   State  County    FIPS Code    Geographic Coordinates    City  RiskScore  \\\n",
       "0     IL  DuPage  17043841308  +41.9708120,-088.2296714  Aurora     35.080   \n",
       "1     IL  DuPage  17043841313  +41.9248149,-088.2282145  Aurora     34.950   \n",
       "2     IL  DuPage  17043841326  +41.9175991,-088.1853745  Aurora     32.225   \n",
       "3     IL  DuPage  17043841316  +41.9766800,-088.1947833  Aurora     30.230   \n",
       "4     IL  DuPage  17043841310  +41.9427967,-088.2393281  Aurora     29.660   \n",
       "5     IL  DuPage  17043841312  +41.9117874,-088.2357549  Aurora     29.450   \n",
       "6     IL  DuPage  17043841327  +41.9524395,-088.1967182  Aurora     27.845   \n",
       "7     IL  DuPage  17043841504  +41.8834958,-088.2007375  Aurora     25.650   \n",
       "8     IL  DuPage  17043841501  +41.8885022,-088.2248959  Aurora     24.960   \n",
       "9     IL    Kane  17089851801  +41.9965296,-088.2842287  Aurora     22.130   \n",
       "10    IL    Kane  17089851907  +41.9958776,-088.3274083  Aurora     21.745   \n",
       "11    IL  DuPage  17043841503  +41.8701285,-088.1994782  Aurora     18.235   \n",
       "12    IL    Kane  17089852001  +41.9627177,-088.2836407  Aurora     16.180   \n",
       "13    IL  DuPage  17043841605  +41.8598398,-088.2287261  Aurora     14.110   \n",
       "14    IL    Kane  17089852102  +41.9575234,-088.3276754  Aurora     12.780   \n",
       "15    IL    Kane  17089853004  +41.8000611,-088.3357209  Aurora     11.535   \n",
       "16    IL    Kane  17089852003  +41.9304462,-088.2853791  Aurora     11.075   \n",
       "17    IL    Kane  17089852300  +41.9115668,-088.3103948  Aurora     10.645   \n",
       "18    IL    Kane  17089852002  +41.9092371,-088.2859844  Aurora     10.480   \n",
       "19    IL    Kane  17089852101  +41.9494354,-088.3541544  Aurora      9.865   \n",
       "\n",
       "                                               Reason  \n",
       "0   Appears in 38 top-10 lists; ain factors: Life ...  \n",
       "1   Appears in 38 top-10 lists; ain factors: Strok...  \n",
       "2   Appears in 34 top-10 lists; ain factors: Delay...  \n",
       "3   Appears in 31 top-10 lists; ain factors: Delay...  \n",
       "4   Appears in 30 top-10 lists; ain factors: Delay...  \n",
       "5   Appears in 32 top-10 lists; ain factors: Life ...  \n",
       "6   Appears in 28 top-10 lists; ain factors: Delay...  \n",
       "7   Appears in 23 top-10 lists; ain factors: Delay...  \n",
       "8   Appears in 31 top-10 lists; ain factors: COPD,...  \n",
       "9   Appears in 28 top-10 lists; ain factors: Flood...  \n",
       "10  Appears in 19 top-10 lists; ain factors: Flood...  \n",
       "11  Appears in 22 top-10 lists; ain factors: Delay...  \n",
       "12  Appears in 18 top-10 lists; ain factors: Modif...  \n",
       "13  Appears in 12 top-10 lists; ain factors: Flood...  \n",
       "14  Appears in 14 top-10 lists; ain factors: Life ...  \n",
       "15  Appears in 15 top-10 lists; ain factors: Strok...  \n",
       "16  Appears in 11 top-10 lists; ain factors: CHD, ...  \n",
       "17  Appears in 12 top-10 lists; ain factors: Flood...  \n",
       "18  Appears in 10 top-10 lists; ain factors: Flood...  \n",
       "19  Appears in 10 top-10 lists; ain factors: Food ...  "
      ]
     },
     "execution_count": 106,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "test = pd.read_csv(\"v2_top20_sensor_candidates.csv\")\n",
    "test"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a31c9822-9462-439c-9c08-dac943119a9d",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
